import pytest
from parser.summarizer import create_short_title, extract_date_info

@pytest.mark.parametrize(
    "text,tags,city,expected",
    [
        (
            "Ð¡ÐºÐ¸Ð´ÐºÐ° 20% Ð½Ð° Ð²ÑÐµ ÑÑƒÑˆÐ¸ Ð¸ Ñ€Ð¾Ð»Ð»Ñ‹! ÐŸÑ€Ð¸Ñ…Ð¾Ð´Ð¸Ñ‚Ðµ Ðº Ð½Ð°Ð¼.",
            ["ÑÐºÐ¸Ð´ÐºÐ°", "Ð°Ð·Ð¸Ñ"],
            "ÐœÐ¾ÑÐºÐ²Ð°",
            "ðŸ’°ðŸœ Ð¡ÐºÐ¸Ð´ÐºÐ° 20% Ð½Ð° Ð²ÑÐµ ÑÑƒÑˆÐ¸ Ð¸ Ñ€Ð¾Ð»Ð»Ñ‹!",
        ),
        (
            "ÐÐ¾Ð²Ñ‹Ð¹ ÑˆÐµÑ„-Ð¿Ð¾Ð²Ð°Ñ€ Ð¿Ñ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ Ð°Ð²Ñ‚Ð¾Ñ€ÑÐºÐ¾Ðµ Ð¼ÐµÐ½ÑŽ Ð·Ð° 1500â‚½",
            ["ÑˆÐµÑ„"],
            "ÐœÐ¾ÑÐºÐ²Ð°",
            "ðŸ‘¨â€ðŸ³ ÐÐ¾Ð²Ñ‹Ð¹ ÑˆÐµÑ„-Ð¿Ð¾Ð²Ð°Ñ€ Ð¿Ñ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ Ð°Ð²Ñ‚Ð¾Ñ€ÑÐºÐ¾Ðµ Ð¼ÐµÐ½ÑŽ â€¢ Ð¾Ñ‚ 1500â‚½",
        ),
        (
            "ÐžÑ‡ÐµÐ½ÑŒ Ð´Ð»Ð¸Ð½Ð½Ð¾Ðµ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ, ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ðµ Ð½ÑƒÐ¶Ð½Ð¾ Ð¾Ð±Ñ€ÐµÐ·Ð°Ñ‚ÑŒ, Ð¿Ð¾Ñ‚Ð¾Ð¼Ñƒ Ñ‡Ñ‚Ð¾ Ð¾Ð½Ð¾ Ð¿Ñ€ÐµÐ²Ñ‹ÑˆÐ°ÐµÑ‚ Ð»Ð¸Ð¼Ð¸Ñ‚ Ð² ÑÑ‚Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð² Ð¸ Ð¼Ð¾Ð¶ÐµÑ‚ Ð·Ð°Ð½ÑÑ‚ÑŒ ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ Ð¼Ð½Ð¾Ð³Ð¾ Ð¼ÐµÑÑ‚Ð°",
            [],
            "ÐœÐ¾ÑÐºÐ²Ð°",
            "ÐžÑ‡ÐµÐ½ÑŒ Ð´Ð»Ð¸Ð½Ð½Ð¾Ðµ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ, ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ðµ Ð½ÑƒÐ¶Ð½Ð¾ Ð¾Ð±Ñ€ÐµÐ·Ð°Ñ‚ÑŒ, Ð¿Ð¾Ñ‚Ð¾Ð¼Ñƒ Ñ‡Ñ‚Ð¾ Ð¾Ð½Ð¾ Ð¿Ñ€ÐµÐ²Ñ‹ÑˆÐ°ÐµÑ‚ Ð»Ð¸Ð¼Ð¸Ñ‚ Ð² ÑÑ‚Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð² Ð¸ Ð¼Ð¾Ð¶ÐµÑ‚...",
        ),
    ],
)
def test_create_short_title(text: str, tags: list[str], city: str, expected: str) -> None:
    assert create_short_title(text, tags, city) == expected

@pytest.mark.parametrize(
    "text,expected",
    [
        (
            "ÐÐºÑ†Ð¸Ñ Ð´ÐµÐ¹ÑÑ‚Ð²ÑƒÐµÑ‚ Ð´Ð¾ 15 ÑÐ½Ð²Ð°Ñ€Ñ",
            "15 ÑÐ½Ð²Ð°Ñ€Ñ",
        ),
        (
            "ÐÐ°Ñ‡Ð¸Ð½Ð°Ñ Ñ 1 Ð¼Ð°Ñ€Ñ‚Ð° Ð½Ð¾Ð²Ð¾Ðµ Ð¼ÐµÐ½ÑŽ",
            "1 Ð¼Ð°Ñ€Ñ‚Ð°",
        ),
        (
            "ÐœÐµÑ€Ð¾Ð¿Ñ€Ð¸ÑÑ‚Ð¸Ðµ Ð¿Ñ€Ð¾Ð¹Ð´ÐµÑ‚ 25 Ð´ÐµÐºÐ°Ð±Ñ€Ñ",
            "25 Ð´ÐµÐºÐ°Ð±Ñ€Ñ",
        ),
        (
            "Ð¢ÐµÐºÑÑ‚ Ð±ÐµÐ· Ð´Ð°Ñ‚Ñ‹",
            None,
        ),
    ],
)
def test_extract_date_info(text: str, expected: str | None) -> None:
    assert extract_date_info(text) == expected 